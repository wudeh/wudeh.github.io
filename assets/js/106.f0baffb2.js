(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{550:function(t,a,e){"use strict";e.r(a);var s=e(3),l=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("学习一下这个额外的请求")])]),t._v(" "),a("h2",{attrs:{id:"什么是预检请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是预检请求"}},[t._v("#")]),t._v(" 什么是预检请求")]),t._v(" "),a("p",[a("code",[t._v("OPTIONS")]),t._v("请求即预检请求，可用于检测服务器允许的"),a("code",[t._v("http")]),t._v("方法。当发起跨域请求时，由于安全原因，触发一定条件时浏览器会在正式请求之前自动先发起"),a("code",[t._v("OPTIONS")]),t._v("请求，即CORS预检请求，服务器若接受该跨域请求，浏览器才继续发起正式请求。")]),t._v(" "),a("h3",{attrs:{id:"跨域请求时-options请求触发条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域请求时-options请求触发条件"}},[t._v("#")]),t._v(" 跨域请求时，OPTIONS请求触发条件")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("使用了下面任一HTTP 方法：")])])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("PUT/DELETE/CONNECT/OPTIONS/TRACE/PATCH\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("人为设置了以下集合之外请求头头部字段：")])])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Accept/Accept-Language/Content-Language/Content-Type/DPR/Downlink/Save-Data/Viewport-Width/Width\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("Content-Type 的值不属于下列之一:")])])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("application/x-www-form-urlencoded、multipart/form-data、text/plain\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("触发了 "),a("code",[t._v("options")]),t._v(" 预检请求的为非简单请求")])]),t._v(" "),a("h2",{attrs:{id:"优化options请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化options请求"}},[t._v("#")]),t._v(" 优化OPTIONS请求")]),t._v(" "),a("p",[a("code",[t._v("Access-Control-Max-Age")]),t._v(" 或者 避免触发")]),t._v(" "),a("ul",[a("li",[t._v("可见一旦达到触发条件，跨域请求便会一直发送2次请求，这样增加的请求数是否可优化呢？答案是可以，"),a("code",[t._v("OPTIONS")]),t._v("预检请求的结果可以被缓存。")])]),t._v(" "),a("blockquote",[a("p",[t._v("Access-Control-Max-Age这个响应首部表示 preflight request  （预检请求）的返回结果（即 Access-Control-Allow-Methods 和Access-Control-Allow-Headers 提供的信息） 可以被缓存的最长时间，单位是秒。(MDN)")])]),t._v(" "),a("p",[t._v("如果值为 -1，则表示禁用缓存，每一次请求都需要提供预检请求，即用OPTIONS请求进行检测。")]),t._v(" "),a("ul",[a("li",[t._v("一般来说，触发 "),a("code",[t._v("options")]),t._v(" 预检请求的常见原因是 "),a("code",[t._v("Content-Type: application/json")]),t._v("，触发了CORS预检请求。")])]),t._v(" "),a("h3",{attrs:{id:"划分简单-预检跨域请求的依据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#划分简单-预检跨域请求的依据"}},[t._v("#")]),t._v(" 划分简单/预检跨域请求的依据")]),t._v(" "),a("ul",[a("li",[t._v("传统的HTML form在不依赖脚本的情况下，通过POST、GET、HEAD请求，content-type可以设置text/plain、multipart/form-data和application/x-www-form-urlencoded三种，来发送跨域请求（url）。简单来说，浏览器对这些形式下的跨域请求做不了任何限制。")]),t._v(" "),a("li",[t._v("其他形式的请求是普通的form无法实现的，需要依赖脚本去添加一些自定义请求头或者form本身无法实现的方法（PUT等）\n根据这个来区分简单/预检请求。")])]),t._v(" "),a("h3",{attrs:{id:"为什么要对非简单跨域请求做预检"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要对非简单跨域请求做预检"}},[t._v("#")]),t._v(" 为什么要对非简单跨域请求做预检？")]),t._v(" "),a("p",[t._v("原因有以下几点：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("减少非简单跨域请求对服务器的影响（开始时就提到，服务器有时候不想理睬跨域请求），比如PUT、DELETE请求可以直接新建或者修改、删除服务器中的资源。预检请求可以防止该情况发生。")])]),t._v(" "),a("li",[a("p",[t._v("减少服务器对于是否跨域的计算量")])])]),t._v(" "),a("p",[t._v("对于非简单请求的跨域请求，服务器对于是否跨域的计算是在预检请求上，如果预检请求通过之后，正式请求都不用再次计算。而且一次预检请求通过后，之后的每次请求都只会发正式请求。节约了很多服务端的计算量。")]),t._v(" "),a("h3",{attrs:{id:"为什么不对简单的跨域请求做预检"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么不对简单的跨域请求做预检"}},[t._v("#")]),t._v(" 为什么不对简单的跨域请求做预检？")]),t._v(" "),a("p",[t._v("原因有以下几点：")]),t._v(" "),a("ul",[a("li",[t._v("form能实现的简单跨域请求，浏览器做不了任何的限制。")]),t._v(" "),a("li",[t._v("没必要对简单请求做预检。比如，一些post请求只是想打个日志，并不需要服务器的响应，但是如果加预检请求，预检请求不通过就做不了这件事。还有一些GET请求、HEAD请求只是想获取资源，并不会修改资源，在不获取响应的时候并不会对服务器造成影响。在这种情况下，加预检请求，只会增加服务器的负担")])])])}),[],!1,null,null,null);a.default=l.exports}}]);