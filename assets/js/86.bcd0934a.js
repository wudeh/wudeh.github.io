(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{540:function(s,a,n){"use strict";n.r(a);var e=n(3),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("注意：前端判断只能是尽量覆盖所有类型，实际上最可靠的还是靠后端判断")]),s._v(" "),a("p",[s._v("前端胖头鱼：遇到一个小米手机文件上传读取不到后缀，当时也尝试用文中的方法，但是难以覆盖全，还是会判断不对。最后还是依赖后端解决的")]),s._v(" "),a("h3",{attrs:{id:"常规类型校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常规类型校验"}},[s._v("#")]),s._v(" 常规类型校验")]),s._v(" "),a("p",[s._v("通常是通过input元素的accept属性来限制文件的类型：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<input id="file" type="file" accept="image/*" />\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("缺点：可通过浏览器控制台删除 accept 属性，绕过限制")]),s._v(" "),a("p",[s._v("或者通过截取文件名后缀的方式来判断：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const ext = file.name.substring(file.name.lastIndexOf('.') + 1);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("缺点：可通过本地修改文件扩展名，绕过限制")]),s._v(" "),a("p",[s._v("但是其实同一种类型的文件，他们的十六进制头信息是完全相同的。可以根据头信息来判断文件类型了。")]),s._v(" "),a("h3",{attrs:{id:"_1-将文件转为十六进制字符串"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-将文件转为十六进制字符串"}},[s._v("#")]),s._v(" 1. 将文件转为十六进制字符串")]),s._v(" "),a("p",[s._v("在获取文件对象后，可以通过FileReader API来读取文件的内容，然后将结果转为Unicode编码，再转为十六进制，以下是封装的将文件转为十六进制字符串的方法：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('async blobToString(blob) {\n  return new Promise(resolve => {\n    const reader = new FileReader()\n    reader.onload = function() {\n      const res = reader.result\n        .split("") // 将读取结果分割为数组\n        .map(v => v.charCodeAt()) // 转为 Unicode 编码\n        .map(v => v.toString(16).toUpperCase()) // 转为十六进制，再转大写\n        .map(v => v.padStart(2, "0")) // 个位数补0\n        .join(" "); // 转为字符串\n      resolve(res)\n    }\n    reader.readAsBinaryString(blob) // 将文件读取为二进制字符串\n  })\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_2-判断文件类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-判断文件类型"}},[s._v("#")]),s._v(" 2. 判断文件类型")]),s._v(" "),a("p",[s._v("没有必要将整个文件转为十六进制，我们只需要截取文件的前几个字节，然后将截取后的文件转为十六进制，再进行比对就可以了：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 判断是否为 jpg 格式\nasync function isJpg(file) {\n  const res = await blobToString(file.slice(0, 3))\n  return res === 'FF D8 FF'\n}\n// 判断是否为 png 格式\nasync function isPng(file) {\n  const res = await blobToString(file.slice(0, 4))\n  return res === '89 50 4E 47'\n}\n// 判断是否为 gif 格式\nasync function isGif(file) {\n  const res = await blobToString(file.slice(0, 4))\n  return res === '47 49 46 38'\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"常用文件的文件头-十六进制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用文件的文件头-十六进制"}},[s._v("#")]),s._v(" 常用文件的文件头（十六进制）")]),s._v(" "),a("p",[s._v("JPEG (jpg)， 文件头：FFD8FF")]),s._v(" "),a("p",[s._v("PNG (png)， 文件头：89504E47")]),s._v(" "),a("p",[s._v("GIF (gif)， 文件头：47494638")]),s._v(" "),a("p",[s._v("TIFF (tif)， 文件头：49492A00")]),s._v(" "),a("p",[s._v("Windows Bitmap ( bmp)，文件头：424D")]),s._v(" "),a("p",[s._v("CAD (dwg)， 文件头：41433130")]),s._v(" "),a("p",[s._v("Adobe Photoshop (psd)， 文件头：38425053")]),s._v(" "),a("p",[s._v("Rich Text Format (rtf)， 文件头：7B5C727466")]),s._v(" "),a("p",[s._v("XML (xml)， 文件头：3C3F786D6C")]),s._v(" "),a("p",[s._v("HTML (html)， 文件头：68746D6C3E")]),s._v(" "),a("p",[s._v("Email [thorough only] (eml)， 文件头：44656C69766572792D646174653A")]),s._v(" "),a("p",[s._v("Outlook Express (dbx)， 文件头：CFAD12FEC5FD746F")]),s._v(" "),a("p",[s._v("Outlook (pst)， 文件头：2142444E")]),s._v(" "),a("p",[s._v("MS Word/Excel (xls.or.doc)， 文件头：D0CF11E0")]),s._v(" "),a("p",[s._v("MS Access (mdb)， 文件头：5374616E64617264204A")]),s._v(" "),a("p",[s._v("WordPerfect (wpd)， 文件头：FF575043")]),s._v(" "),a("p",[s._v("Adobe Acrobat (pdf)， 文件头：255044462D312E")]),s._v(" "),a("p",[s._v("Quicken (qdf)， 文件头：AC9EBD8F")]),s._v(" "),a("p",[s._v("Windows Password (pwl)， 文件头：E3828596")]),s._v(" "),a("p",[s._v("ZIP Archive (zip)， 文件头：504B0304")]),s._v(" "),a("p",[s._v("RAR Archive (rar)， 文件头：52617221")]),s._v(" "),a("p",[s._v("Wave (wav)， 文件头：57415645")]),s._v(" "),a("p",[s._v("AVI (avi)， 文件头：41564920")]),s._v(" "),a("p",[s._v("Real Audio (ram)， 文件头：2E7261FD")]),s._v(" "),a("p",[s._v("Real Media (rm)， 文件头：2E524D46")]),s._v(" "),a("p",[s._v("MPEG (mpg)， 文件头：000001BA")]),s._v(" "),a("p",[s._v("MPEG (mpg)， 文件头：000001B3")]),s._v(" "),a("p",[s._v("Quicktime (mov)， 文件头：6D6F6F76")]),s._v(" "),a("p",[s._v("Windows Media (asf)， 文件头：3026B2758E66CF11")]),s._v(" "),a("p",[s._v("MIDI (mid)， 文件头：4D546864")])])}),[],!1,null,null,null);a.default=t.exports}}]);