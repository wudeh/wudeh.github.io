(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{537:function(s,a,e){"use strict";e.r(a);var t=e(3),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"tofixed-的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tofixed-的问题"}},[s._v("#")]),s._v(" toFixed 的问题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1.36.toFixed(1) // 1.4 没有问题\n1.31.toFixed(1) // 1.3 没有问题\n\n1.35.toFixed(1) // 1.4 这里的5入\n1.45.toFixed(1) // 1.4 这里的5又舍去了。\n\n1.15.toFixed(1) // 1.1 并没有进1 成1.2来凑偶数\n1.05.toFixed(1) // 1.1 进1之后反倒成奇数了\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[s._v("#")]),s._v(" 原因")]),s._v(" "),a("p",[s._v("不是所谓的银行家算法，也不是四舍六入五成双，就是"),a("code",[s._v("四舍五入")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1.15.toPrecision(100)\n// 1.149999999999999911182158029987476766109466552734375000000000000000000000000000000000000000000000000\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1.15 在系统中就不是严格上的 1.15，通过这个高精度表示的数字来看，就知道为什么 1.15.toFixed(1) 的结果为什么是1.1了，因为小数点后第二位根本不是5而且4，所以直接舍去了")]),s._v(" "),a("p",[s._v("不管浏览器具体采用的是什么逻辑，通过 js 标准以及这些例子，可以确定 "),a("code",[s._v("toFixed")]),s._v(" 方法使用的逻辑是"),a("code",[s._v("四舍五入")]),s._v("，至于为什么部分数字不符合预期，是由于精度问题导致了。就好像为什么 "),a("code",[s._v("0.1 + 0.2 !== 0.3")]),s._v(" 是一样的")]),s._v(" "),a("p",[s._v("运算前会转成二进制\n误差的来源是在IEE 754 双精度浮点数标准下，二进制数据无法精确的标识小数（一些小数转换成二进制长度会无限循环）")]),s._v(" "),a("h2",{attrs:{id:"解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),a("p",[s._v("两个三方库："),a("code",[s._v("yatter")]),s._v(", "),a("code",[s._v("decimal-format")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import {toFixed} from 'yatter';\n\nconsole.log(toFixed(87.55, 1)) // 87.6\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import DecimalFormat from 'decimal-format';\n\nconst df = new DecimalFormat('0.0');\ndf.format(87.55); // 87.6\n\ndf.setRoundingMode(RoundingMode.HALF_EVEN); // 设置为 四舍六入五成双 模式\ndf.format(87.85) // 87.8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);