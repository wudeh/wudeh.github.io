---
title: requestAnimationFrame
sidebar: auto
date: 2021-07-25 00:00:00
tags: 
  - JavaScript
categories: 
  - JavaScript
permalink: /pages/f6fd0267078de/
---

## ä»€ä¹ˆæ˜¯ requestAnimationFrame
é¡¾åæ€ä¹‰ï¼Œè¯·æ±‚åŠ¨ç”»å¸§ï¼Œä¹Ÿç§° å¸§å¾ªç¯

## æ€ä¹ˆç”¨

>window.requestAnimationFrame()  

- å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚

```
function test() {
    console.log('ğŸš€ğŸš€hello ~ requestAnimationFrame');
  }
  requestAnimationFrame(test)
```

## æ€ä¹ˆåšåŠ¨ç”»
```
æ³¨æ„ï¼šè‹¥ä½ æƒ³åœ¨æµè§ˆå™¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰ç»§ç»­æ›´æ–°ä¸‹ä¸€å¸§åŠ¨ç”»ï¼Œé‚£ä¹ˆå›è°ƒå‡½æ•°è‡ªèº«å¿…é¡»å†æ¬¡è°ƒç”¨window.requestAnimationFrame()
```
è¯´äººè¯ï¼šé€’å½’è°ƒç”¨è‡ªå·±

```
let n = 0
  function test() {
    n++
    console.log(`ğŸš€ğŸš€hello ~ requestAnimationFrame ${n}`);
    requestAnimationFrame(test)
  }
  requestAnimationFrame(test)
```

## æ‰§è¡Œé¢‘ç‡
>å›è°ƒå‡½æ•°æ‰§è¡Œæ¬¡æ•°é€šå¸¸æ˜¯æ¯ç§’ 60 æ¬¡ï¼Œä½†åœ¨å¤§å¤šæ•°éµå¾ª W3C å»ºè®®çš„æµè§ˆå™¨ä¸­ï¼Œå›è°ƒå‡½æ•°æ‰§è¡Œæ¬¡æ•°é€šå¸¸ä¸ æµè§ˆå™¨å±å¹•åˆ·æ–°æ¬¡æ•° ç›¸åŒ¹é…ã€‚

å±å¹•åˆ·æ–°é¢‘ç‡ï¼ˆæ¬¡æ•°ï¼‰ï¼š å±å¹•æ¯ç§’å‡ºç°å›¾åƒçš„æ¬¡æ•°ã€‚æ™®é€šç¬”è®°æœ¬ä¸º60Hzã€‚

## å›è°ƒå‚æ•°(æ‰§è¡Œæ—¶é—´)

>å›è°ƒå‡½æ•°ä¼šè¢«ä¼ å…¥DOMHighResTimeStampå‚æ•°ï¼ŒDOMHighResTimeStampæŒ‡ç¤ºå½“å‰è¢« requestAnimationFrame() æ’åºçš„å›è°ƒå‡½æ•°è¢«è§¦å‘çš„æ—¶é—´ã€‚

```
function test(timestamp) {
    console.log(`ğŸš€ğŸš€hello ~ requestAnimationFrame ${timestamp}`);
    requestAnimationFrame(test)
  }
  requestAnimationFrame(test)
```
æ­¤æ—¶é—´ç²¾ç¡®åˆ°ä¸‰ä½å°æ•°

æ³¨æ„ï¼š

>åœ¨åŒä¸€ä¸ªå¸§ä¸­çš„ å¤šä¸ªå›è°ƒå‡½æ•° ï¼Œå®ƒä»¬æ¯ä¸€ä¸ªéƒ½ä¼šæ¥å—åˆ°ä¸€ä¸ª ç›¸åŒçš„æ—¶é—´æˆ³ ï¼Œå³ä½¿åœ¨è®¡ç®—ä¸Šä¸€ä¸ªå›è°ƒå‡½æ•°çš„å·¥ä½œè´Ÿè½½æœŸé—´å·²ç» æ¶ˆè€—äº†ä¸€äº›æ—¶é—´ ã€‚è¯¥æ—¶é—´æˆ³æ˜¯ä¸€ä¸ªåè¿›åˆ¶æ•°ï¼Œå•ä½æ¯«ç§’ï¼Œæœ€å°ç²¾åº¦ä¸º1ms(1000Î¼s)ã€‚

å°±æ˜¯æµè§ˆå™¨åˆ·æ–°ä¸€æ¬¡çš„æ—¶å€™ï¼Œæ‰§è¡Œæ‰€æœ‰çš„ requestAnimationFrame ï¼Œå¹¶ä¸”å®ƒä»¬çš„å›è°ƒå‚æ•°æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚

## æµè§ˆå™¨å¯¹å®ƒçš„ä¼˜åŒ–

>ä¸ºäº†æé«˜æ€§èƒ½å’Œç”µæ± å¯¿å‘½ï¼Œå› æ­¤åœ¨å¤§å¤šæ•°æµè§ˆå™¨é‡Œï¼Œå½“requestAnimationFrame() è¿è¡Œåœ¨åå°æ ‡ç­¾é¡µæˆ–è€…éšè—çš„<iframe> é‡Œæ—¶ï¼ŒrequestAnimationFrame() ä¼šè¢«æš‚åœè°ƒç”¨ä»¥æå‡æ€§èƒ½å’Œç”µæ± å¯¿å‘½ã€‚

è¯´äººè¯ï¼šä¸åœ¨å½“å‰é¡µé¢ï¼Œä¸æ‰§è¡Œ requestAnimationFrameï¼Œå›æ¥åå†æ‰§è¡Œ

## è¿”å›å€¼

>ä¸€ä¸ª long æ•´æ•°ï¼Œè¯·æ±‚ ID ï¼Œæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ã€‚æ˜¯ä¸ªéé›¶å€¼ï¼Œæ²¡åˆ«çš„æ„ä¹‰ã€‚

>ä½ å¯ä»¥ä¼ è¿™ä¸ªå€¼ç»™ window.cancelAnimationFrame() ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚

```
const beginBtn = document.querySelector("#begin")

  const endBtn = document.querySelector("#end")

  let myRef;

  beginBtn.addEventListener("click", () => {
    myRef = requestAnimationFrame(test)
  })

  endBtn.addEventListener("click", () => {
    cancelAnimationFrame(myRef)
  })

  function test() {
    myRef = requestAnimationFrame(test)
    console.log('ğŸš€ğŸš€~ myRef:', myRef);
  }
```

ä¹Ÿå¯ä»¥è®¾ç½®æ¡ä»¶æ¥ç»ˆæ­¢

```
 function test(timestamp) {
    console.log(`ğŸš€ğŸš€hello ~ requestAnimationFrame ${timestamp}`);
    if (timestamp < 500) {
      requestAnimationFrame(test)
    }
  }
  requestAnimationFrame(test)
```

## setTimeout && setInterval
setTimeout å’Œ setInterval çš„é—®é¢˜æ˜¯ï¼Œå®ƒä»¬ä¸å¤Ÿç²¾ç¡®ã€‚å®ƒä»¬çš„å†…åœ¨è¿è¡Œæœºåˆ¶å†³å®šäº† æ—¶é—´é—´éš”å‚æ•° å®é™…ä¸Šåªæ˜¯æŒ‡å®šäº†æŠŠåŠ¨ç”»ä»£ç æ·»åŠ åˆ° æµè§ˆå™¨UIçº¿ç¨‹é˜Ÿåˆ— ä¸­ä»¥ç­‰å¾…æ‰§è¡Œçš„æ—¶é—´ã€‚å¦‚æœé˜Ÿåˆ—å‰é¢å·²ç»åŠ å…¥äº†å…¶å®ƒä»»åŠ¡ï¼Œé‚£åŠ¨ç”»ä»£ç å°±è¦ç­‰å‰é¢çš„ ä»»åŠ¡å®Œæˆå å†æ‰§è¡Œï¼Œå¹¶ä¸”å¦‚æœæ—¶é—´é—´éš”è¿‡çŸ­ï¼ˆå°äº16.7msï¼‰ä¼šé€ æˆä¸¢å¸§ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´åŠ¨ç”»å¯èƒ½ä¸ä¼šæŒ‰ç…§é¢„è®¾çš„å»æ‰§è¡Œï¼Œé™ä½ç”¨æˆ·ä½“éªŒã€‚
requestAnimationFrame é‡‡ç”¨ æµè§ˆå™¨æ—¶é—´é—´éš” ï¼Œä¿æŒæœ€ä½³ç»˜åˆ¶æ•ˆç‡ï¼Œä¸ä¼šå› ä¸ºé—´éš”æ—¶é—´è¿‡çŸ­ï¼Œé€ æˆè¿‡åº¦ç»˜åˆ¶ï¼Œæ¶ˆè€—æ€§èƒ½ï¼›ä¹Ÿä¸ä¼šå› ä¸ºé—´éš”æ—¶é—´å¤ªé•¿ï¼Œä½¿ç”¨åŠ¨ç”»å¡é¡¿ä¸æµç•…ï¼Œè®©å„ç§ç½‘é¡µåŠ¨ç”»æ•ˆæœèƒ½å¤Ÿæœ‰ä¸€ä¸ª ç»Ÿä¸€ çš„åˆ·æ–°æœºåˆ¶ï¼Œä»è€ŒèŠ‚çœç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ”¹å–„è§†è§‰æ•ˆæœã€‚

## CSS3åŠ¨ç”»
CSS3 çš„transition å’Œ animation æ­é…ä½¿ç”¨å¯ä»¥è¯´æ˜¯éå¸¸å¼ºå¤§äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰åšä¸åˆ°çš„åœ°æ–¹ï¼Œæ¯”å¦‚è¯´
scrollTopï¼Œå¦å¤– CSS3 åŠ¨ç”»æ”¯æŒçš„è´å¡å°”æ›²çº¿ä¹Ÿæ˜¯æœ‰é™çš„ã€‚CSS3 åšä¸åˆ°çš„å°±å¯ä»¥ç”¨åˆ° requestAnimationFrame æ¥è§£å†³äº†

## ç¼ºç‚¹
ä¸€èˆ¬æ¥è¯´ï¼ŒrequestAnimationFrame æ‰§è¡Œéƒ½æ˜¯å¾ˆç¨³å®šçš„ï¼Œä½†æ˜¯å½“æµè§ˆå™¨æ¸²æŸ“çº¿ç¨‹è¢«è¿‡åº¦å ç”¨æ—¶è¿™ä¸ªAPIè°ƒç”¨é—´éš”ä¼šéå¸¸ä¸ç¨³å®šï¼Œå®ƒå¹¶ä¸æ˜¯é“¶å¼¹ã€‚
