---
title: å‰ç«¯åŸºç¡€ - æ‰‹å†™ç³»åˆ—
sidebar: auto
date: 2020-12-03 00:00:00
tags: 
  - æºç 
categories: 
  - é¢è¯•
permalink: /pages/9de40adc21b12/
---

> ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ ğŸ•µğŸ•µğŸ•µ

<!-- more -->


## å®ç° callã€applyã€bind

### call
```
function myCall(ctx = window, ...args) {
  ctx = ctx || window;
  // ä¸ºcontext åˆ›å»ºä¸€ä¸ª Symbolï¼ˆä¿è¯ä¸ä¼šé‡åï¼‰å±æ€§ï¼Œå°†å½“å‰å‡½æ•°èµ‹å€¼ç»™è¿™ä¸ªå±æ€§
  const fn = Symbol();
  ctx[fn] = this;
  // å¤„ç†å‚æ•°ï¼Œä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°åçš„å…¶ä½™å‚æ•°
  const res = ctx[fn](...args);
  // è°ƒç”¨å‡½æ•°åå³åˆ é™¤è¯¥Symbolå±æ€§
  delete ctx[fn];
  return res;
}
Function.prototype.call = function (context, ...args) {

  var context = context || window;

  context.fn = this;

  var result = eval('context.fn(...args)');

  delete context.fn

  return result;

}
```
### apply

```
function myApply(ctx = window, args) {
  ctx = ctx || window;
  const fn = Symbol();
  ctx[fn] = this;
  if (Array.isArray(args)) {
    result = ctx[fn](...args);
  } else {
    result = ctx[fn]();
  }
  delete ctx[fn];
  return res;
}
Function.prototype.apply = function (context, args) {

  let context = context || window;

  context.fn = this;

  let result = eval('context.fn(...args)');

  delete context.fn

  return result;

}
```
### bind
```
function myBind(ctx, ...args1) {
  const _this = this;
  return function F(...args2) {
    if (this instanceof F) {
      // åˆ¤æ–­æ˜¯å¦ä¸ºæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœæ˜¯åˆ™ä½¿ç”¨newè°ƒç”¨å½“å‰å‡½æ•°
      return new _this(...args1, ...args2)
    } else {
      // å¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨applyï¼Œå°†contextå’Œå¤„ç†å¥½çš„å‚æ•°ä¼ å…¥
      return _this.apply(ctx, args1.concat(args2))
    }
  }
}
```

## å®ç°å‘å¸ƒè®¢é˜…ã€è§‚å¯Ÿè€…æ¨¡å¼

[è§‚å¯Ÿè€…æ¨¡å¼ä¸è®¢é˜…å‘å¸ƒæ¨¡å¼çš„åŒºåˆ«](https://www.cnblogs.com/onepixel/p/10806891.html)

`ä¸€å¥è¯æ€»ç»“ï¼š å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ˜¯é¢å‘è°ƒåº¦ä¸­å¿ƒç¼–ç¨‹çš„ï¼Œè€Œè§‚å¯Ÿè€…æ¨¡å¼åˆ™æ˜¯é¢å‘ç›®æ ‡å’Œè§‚å¯Ÿè€…ç¼–ç¨‹çš„ã€‚å‰è€…ç”¨äºè§£è€¦å‘å¸ƒè€…å’Œè®¢é˜…è€…ï¼Œåè€…ç”¨äºè€¦åˆç›®æ ‡å’Œè§‚å¯Ÿè€…`

## å‘å¸ƒè®¢é˜…

```
class PubSub {
	constructor() {
		this.subers = [];
	}

	sub(topic, callback) {
		let callbacks = this.subers[topic];
		if (!callbacks) {
			this.subers[topic] = [callback];
		} else {
			callbacks.push(callback);
		}
	}

	pub(topic, ...args) {
		let callbacks = this.subers[topic];
		callbacks.forEach(callback => callback(...args))
	}
}

const aEvent = (msg) => {
	console.log(msg + 'aaa');
}

const bEvent = (msg) => {
	console.log(msg + 'bbb');
}

let pubsub = new PubSub();

pubsub.sub('a', aEvent)
pubsub.sub('b', bEvent)

pubsub.pub('a', 'Aè®¢é˜…è€…')
pubsub.pub('b', 'Bè®¢é˜…è€…')
```
### è§‚å¯Ÿè€…æ¨¡å¼

```
class Sub {
	constructor() {
		this.obers = []
	}

	add(ob) {
		this.obers.push(ob)
	}

	notify(...args) {
		this.obers.forEach(ob => ob.update(...args))
	}
}

class Ob {
	update(...args) {
		console.log(...args)
	}
}

let ob1 = new Ob();
let ob2 = new Ob();

let sub = new Sub();

sub.add(ob1)
sub.add(ob2)


sub.notify('ç›®æ ‡å‘ç”Ÿäº†å˜åŒ–')
```

## debounce
ä¸€æ®µæ—¶é—´å†…åªæ‰§è¡Œæœ€åä¸€æ¬¡
```
function debounce(fn, delay=500) {
    // timer å†™åœ¨é—­åŒ…ä¸­ï¼Œå› æ­¤é˜²æŠ–ä¹Ÿæ˜¯é—­åŒ…çš„ä¸€ä¸ªåº”ç”¨
    let timer = null;

    return function() {
        if (timer) {
            clearTimeout(timer)
        }
        timer = setTimeout(() => {
            fn.apply(this, arguments);
            timer = null;
        }, delay)
    }
}

// éªŒè¯
input1.addEventListener('keyup', debounce(() => {
    console.log(input1.value);
}), 600)
```
## throttle
ä¸€æ®µæ—¶é—´å†…åªæ‰§è¡Œç¬¬ä¸€æ¬¡
```
function throttle(fn, delay = 100) {
    let timer = null

    return function() {
        if (timer) {
            return
        }
        timer = setTimeout(() => {
            fn.apply(this, arguments)
            clearTimeout(timer) 
            timer = null
        }, delay)
    }
}

div1.addEventListener(('drag', throttle(function (e) {
    console.log(e.offsetX, e.offsetY)
})))
```


>å†™äº†å°±å¿˜ï¼Œè¿˜å†™å•¥å­ï¼ï¼

## call, apply, bind

éƒ½æ˜¯æ”¹å˜ `this` æŒ‡å‘ï¼Œåªä¸è¿‡ `call` å’Œ `apply` æ”¹å˜åä¼šç«‹å³æ‰§è¡Œï¼Œä¸” `apply` çš„å…¶ä½™å‚æ•°ä¸ºæ•°ç»„ï¼›`bind` æ”¹å˜ `this` åä¸ä¼šç«‹å³æ‰§è¡Œ

```
Function.prototype.myCall = function(context, ...args) {
  if(!context || context === null) {
    cotext = window;
  }
  // ç”¨ Symbol() åš key ï¼Œé¿å…å±æ€§é‡å¤
  let fn = Symbol();
  // ç»™ä¼ è¿›æ¥çš„å¯¹è±¡åŠ ä¸Šä¸€ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œçš„ `this` å°±æ˜¯è¦æ‰§è¡Œçš„å‡½æ•°
  // åˆ©ç”¨å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œæ–¹æ³•é‡Œé¢çš„ this æ˜¯è¿™ä¸ªå¯¹è±¡ï¼Œ è¿™ç§æ–¹å¼æ¥æ”¹å˜ this çš„æŒ‡å‘
  context[fn] = this;
  // è¿”å›ç»“æœæ˜¯æ‰§è¡Œå‡½æ•°åçš„ç»“æœ
  return context[fn](...args);
}

// apply çš„åŒºåˆ«å°±æ˜¯å¯¹äºæ•°ç»„å‚æ•°çš„å¤„ç†
Function.prototype.myApply = function(context, args) {
  if(!context || context === null) {
    context = window;
  }
  let fn = Symbol();
  context[fn] = this;
  return context[fn](...args);
}

// bind
Function.prototype.myBind = function(context, ...args) {
    if (typeof this !== "function") {
        throw TypeError("type error");
    }
    let fn = this;
    return function Fn() {
        // æ ¹æ®è°ƒç”¨æ–¹å¼ï¼Œä¼ å…¥ä¸åŒç»‘å®šå€¼
        // å¦‚æœæ˜¯ä½œä¸ºæ„é€ å‡½æ•°çš„è¯ï¼Œthis æŒ‡å‘æ–° new å‡ºæ¥çš„å¯¹è±¡
        return fn.apply(this instanceof Fn ? this : context, args.concat(...arguments));
    }
}
```

## Promise.all
è¿”å›ä¸€ä¸ª promise å¯¹è±¡

>æ€è·¯å¾ˆç®€å•ï¼ŒæŠŠæ‰€æœ‰ Promise resolve() çš„ç»“æœ push åˆ°ç©ºæ•°ç»„ä¸­ï¼Œå½“æ•°ç»„é•¿åº¦ç­‰äº Promise æ•°ç»„çš„é•¿åº¦æ—¶å°±å¯ä»¥è¿”å›ç»“æœæ•°ç»„äº†

å½“ç„¶åªè¦æœ‰ä¸€ä¸ª reject å°±è¿”å› reject çš„ç»“æœ

```
Promise.all = function (iterators) {
  return new Promise((resolve, reject) => {
    if (!iterators || iterators.length === 0) {
      resolve([]);
    } else {
      let count = 0; // è®¡æ•°å™¨ï¼Œç”¨äºåˆ¤æ–­æ‰€æœ‰ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆ
      let result = []; // ç»“æœæ•°ç»„
      for (let i = 0; i < iterators.length; i++) {
        // è€ƒè™‘åˆ°iterators[i]å¯èƒ½æ˜¯æ™®é€šå¯¹è±¡ï¼Œåˆ™ç»Ÿä¸€åŒ…è£…ä¸ºPromiseå¯¹è±¡
        Promise.resolve(iterators[i]).then(
          (data) => {
            result[i] = data; // æŒ‰é¡ºåºä¿å­˜å¯¹åº”çš„ç»“æœ
            // å½“æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåï¼Œå†ç»Ÿä¸€è¿”å›ç»“æœ
            if (++count === iterators.length) {
              resolve(result);
            }
          },
          (err) => {
            reject(err); // ä»»ä½•ä¸€ä¸ªPromiseå¯¹è±¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨reject()æ–¹æ³•
            return;
          }
        );
      }
    }
  });
};
```

## Promise.race
è¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ª promise å¯¹è±¡ resolved æˆ– rejectedï¼Œè¿”å›çš„ promise å¯¹è±¡å°±ä¼š resolve æˆ– reject ç›¸åº”çš„å€¼ã€‚

>è¿™ä¸ªç®€å•ï¼Œç›´æ¥æå°±è¡Œ

```
Promise.race = function (iterators) {
  return new Promise((resolve, reject) => {
    for (const iter of iterators) {
      Promise.resolve(iter)
        .then((res) => {
          resolve(res);
        })
        .catch((e) => {
          reject(e);
        });
    }
  });
};
```

## Promise.allSeleted
å¾ªç¯æŠŠæ‰€æœ‰ä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥çš„ç»“æœä¿å­˜èµ·æ¥å°±è¡Œ

```
Promise.allSeleted = function(promises) {
    let count = 0
    let result = []
    return new Promise((resolve, reject) => {
        promises.forEach((promise, index) => {
            Promise.resolve(promise).then(res => {
                result[index] = {
                    value: res,
                    reason: null,
                }
            }, err => {
                result[index] = {
                    value: null,
                    reason: err,
                }
            }).finally(() => {
                count++
                if (count === promises.length) {
                    resolve(result)
                }
            })
        })
    })
}
```

## compose

